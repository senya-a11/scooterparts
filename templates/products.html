<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="–ü–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç–æ–≤ IMPORT. –ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã, –º–æ—Ç–æ—Ä—ã, —Ç–æ—Ä–º–æ–∑–∞, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, –∫–æ–ª–µ—Å–∞ –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã. –ë–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä, –ª—É—á—à–∏–µ —Ü–µ–Ω—ã.">
  <meta name="keywords" content="–∫—É–ø–∏—Ç—å –∑–∞–ø—á–∞—Å—Ç–∏ —Å–∞–º–æ–∫–∞—Ç, –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä —ç–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç, –º–æ—Ç–æ—Ä-–∫–æ–ª–µ—Å–æ, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä, —Ç–æ—Ä–º–æ–∑–Ω—ã–µ –¥–∏—Å–∫–∏, –∫–∞—Ç–∞–ª–æ–≥ –∑–∞–ø—á–∞—Å—Ç–µ–π">
  <meta name="robots" content="index, follow">
  
  <!-- Open Graph -->
  <meta property="og:title" content="–ö–∞—Ç–∞–ª–æ–≥ –∑–∞–ø—á–∞—Å—Ç–µ–π ‚Äî IMPORT">
  <meta property="og:description" content="–ë–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è —ç–ª–µ–∫—Ç—Ä–æ—Å–∞–º–æ–∫–∞—Ç–æ–≤ –ø–æ –ª—É—á—à–∏–º —Ü–µ–Ω–∞–º">
  <meta property="og:type" content="website">
  
  <link rel="icon" href="/static/favicon/favicon.ico" type="image/x-icon">
  <meta name="theme-color" content="#080A0F">
  <title>–ö–∞—Ç–∞–ª–æ–≥ –∑–∞–ø—á–∞—Å—Ç–µ–π ‚Äî IMPORT</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#080A0F; --bg-2:#0D1017; --bg-3:#12161E;
      --surface:#161B24; --surface-2:#1E2533;
      --border:rgba(255,255,255,0.06); --border-hover:rgba(255,255,255,0.12);
      --text:#F0F2F5; --text-2:#8B92A5; --text-3:#4E5568;
      --accent:#00D4FF; --accent-dim:rgba(0,212,255,0.12); --accent-glow:rgba(0,212,255,0.25);
      --green:#00E5A0; --green-dim:rgba(0,229,160,0.12);
      --red:#FF4757; --red-dim:rgba(255,71,87,0.12);
      --amber:#FFB020; --amber-dim:rgba(255,176,32,0.12);
      --radius:10px; --radius-lg:16px;
      --font-d:'Syne',sans-serif; --font-b:'DM Sans',sans-serif;
      --ease:cubic-bezier(0.16,1,0.3,1);
    }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{font-family:var(--font-b);background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;display:flex;flex-direction:column;-webkit-font-smoothing:antialiased}
    body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:9999;opacity:.4}
    .container{max-width:1280px;margin:0 auto;padding:0 1.5rem}
    ::-webkit-scrollbar{width:6px} ::-webkit-scrollbar-track{background:var(--bg-2)} ::-webkit-scrollbar-thumb{background:var(--surface-2);border-radius:3px}

    /* Header */
    .header{position:fixed;top:0;left:0;right:0;background:rgba(8,10,15,.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);z-index:200}
    .header-inner{display:flex;align-items:center;justify-content:space-between;height:64px;gap:2rem}
    .logo{display:flex;align-items:center;gap:10px;font-family:var(--font-d);font-size:1.25rem;font-weight:700;color:var(--text);text-decoration:none}
    .logo-mark{width:32px;height:32px;display:flex;align-items:center;justify-content:center;font-size:20px;position:relative}
    .logo-mark::after{content:'‚ö°';position:absolute;background:linear-gradient(135deg,#FFD700 0%,#FFA500 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 0 8px rgba(255,215,0,.4))}
    .logo-text span{color:var(--accent)}
    .nav{display:flex;align-items:center;gap:.25rem}
    .nav-link{font-size:.875rem;font-weight:500;color:var(--text-2);text-decoration:none;padding:.5rem .875rem;border-radius:6px;transition:all .2s}
    .nav-link:hover{color:var(--text);background:rgba(255,255,255,.05)}
    .nav-link.active{color:var(--accent);background:var(--accent-dim)}
    .header-actions{display:flex;align-items:center;gap:.75rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:.5rem;padding:.625rem 1.25rem;font-family:var(--font-b);font-size:.875rem;font-weight:600;border-radius:var(--radius);border:none;cursor:pointer;text-decoration:none;transition:all .2s;white-space:nowrap}
    .btn-primary{background:var(--accent);color:#080A0F;font-weight:700}
    .btn-primary:hover{transform:translateY(-1px);box-shadow:0 0 20px var(--accent-glow)}
    .btn-ghost{background:transparent;color:var(--text-2);border:1px solid var(--border)}
    .btn-ghost:hover{color:var(--text);border-color:var(--border-hover);background:rgba(255,255,255,.04)}
    .btn-sm{padding:.375rem .875rem;font-size:.8125rem}
    .cart-btn{position:relative}
    .cart-count{position:absolute;top:-6px;right:-6px;background:var(--red);color:white;font-size:.6875rem;font-weight:700;min-width:18px;height:18px;border-radius:9px;padding:0 4px;display:none;align-items:center;justify-content:center}

    /* Page header */
    .page-header{padding-top:5.5rem;padding-bottom:2rem;background:var(--bg);border-bottom:1px solid var(--border);position:relative;overflow:hidden}
    .page-header-bg{position:absolute;top:-200px;left:-100px;width:600px;height:400px;background:radial-gradient(ellipse,rgba(0,212,255,.06) 0%,transparent 70%);pointer-events:none}
    .page-title{font-family:var(--font-d);font-size:2rem;font-weight:800;letter-spacing:-.03em;margin-bottom:.375rem}
    .page-desc{font-size:.9375rem;color:var(--text-2)}
    .page-header-inner{display:flex;align-items:flex-end;justify-content:space-between;gap:2rem;flex-wrap:wrap}

    /* Filter bar */
    .filter-bar{background:var(--bg-2);border-bottom:1px solid var(--border);padding:.875rem 0;position:sticky;top:64px;z-index:100;backdrop-filter:blur(12px)}
    .filter-inner{display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
    .filter-select{padding:.5rem .875rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);color:var(--text);font-family:var(--font-b);font-size:.875rem;outline:none;cursor:pointer;transition:all .2s;-webkit-appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%238B92A5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right .625rem center;background-size:14px;padding-right:2rem}
    .filter-select:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-dim)}
    .search-wrap{position:relative;flex:1;min-width:200px;max-width:340px}
    .search-input{width:100%;padding:.5rem 1rem .5rem 2.25rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);color:var(--text);font-family:var(--font-b);font-size:.875rem;outline:none;transition:all .2s}
    .search-input::placeholder{color:var(--text-3)}
    .search-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-dim)}
    .search-icon{position:absolute;left:.75rem;top:50%;transform:translateY(-50%);color:var(--text-3);pointer-events:none}
    .filter-count{margin-left:auto;font-size:.8125rem;color:var(--text-2)}

    /* Products */
    .main{flex:1;padding:2rem 0 2rem}
    .cat-pills{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:1.5rem}
    .cat-pill{padding:.375rem .875rem;border-radius:100px;font-size:.8125rem;font-weight:600;border:1px solid var(--border);background:var(--surface);color:var(--text-2);cursor:pointer;transition:all .2s}
    .cat-pill:hover{border-color:var(--border-hover);color:var(--text)}
    .cat-pill.active{background:var(--accent-dim);border-color:rgba(0,212,255,.3);color:var(--accent)}
    .products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(270px,1fr));gap:1.25rem}
    .product-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;transition:all .3s var(--ease);display:flex;flex-direction:column}
    .product-card:hover{border-color:rgba(0,212,255,.2);transform:translateY(-4px);box-shadow:0 12px 40px rgba(0,0,0,.5)}
    .product-img{width:100%;height:210px;background:var(--bg-3);display:flex;align-items:center;justify-content:center;font-size:3.5rem;overflow:hidden;border-bottom:1px solid var(--border);position:relative}
    .product-img img{width:100%;height:100%;object-fit:cover;transition:opacity .3s ease}
    .product-img img[loading="lazy"]{opacity:0}
    .product-img img[loading="lazy"].loaded{opacity:1}
    .product-badge{position:absolute;left:.75rem;padding:.25rem .625rem;border-radius:100px;font-size:.6875rem;font-weight:700;display:block}
    .product-badge:nth-of-type(1){top:.75rem}
    .product-badge:nth-of-type(2){top:2.5rem}
    .product-badge:nth-of-type(3){top:4.25rem}
    .badge-featured{background:var(--amber-dim);color:var(--amber);border:1px solid rgba(255,176,32,.25)}
    .badge-new{background:var(--green-dim);color:var(--green);border:1px solid rgba(0,229,160,.25)}
    .badge-out{background:rgba(255,255,255,.06);color:var(--text-3)}
    .badge-preorder{background:rgba(147,112,219,.15);color:#9B59B6;border:1px solid rgba(147,112,219,.3)}
    .badge-instock{background:var(--green-dim);color:var(--green);border:1px solid rgba(0,229,160,.25)}

    .product-body{padding:1.25rem;flex:1;display:flex;flex-direction:column}
    .product-cat{font-size:.75rem;font-weight:700;letter-spacing:.06em;text-transform:uppercase;color:var(--accent);margin-bottom:.375rem}
    .product-name{font-family:var(--font-d);font-size:1rem;font-weight:700;margin-bottom:.5rem;line-height:1.3}
    .product-desc{font-size:.8125rem;color:var(--text-2);line-height:1.5;flex:1;margin-bottom:1rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .product-footer{display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-top:auto}
    .product-price{font-family:'JetBrains Mono',monospace;font-size:1.25rem;font-weight:700;letter-spacing:-.01em}
    
    /* Product badges - moved to body like on main page */
    .product-badges{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:.75rem}
    .product-badge-inline{display:inline-flex;align-items:center;padding:.25rem .625rem;border-radius:6px;font-size:.75rem;font-weight:700}
    .badge-featured{background:var(--accent-dim);color:var(--accent);border:1px solid rgba(0,212,255,.2)}
    .badge-stock{background:var(--green-dim);color:var(--green);border:1px solid rgba(0,229,160,.2)}
    .badge-preorder{background:var(--amber-dim);color:var(--amber);border:1px solid rgba(255,176,32,.2)}
    .badge-out{background:var(--red-dim);color:var(--red);border:1px solid rgba(255,71,87,.2)}
    
    .add-btn{padding:.5rem 1rem;background:var(--accent);color:#080A0F;border:none;border-radius:var(--radius);cursor:pointer;font-family:var(--font-b);font-size:.8125rem;font-weight:700;transition:all .2s}
    .add-btn:hover{box-shadow:0 0 16px var(--accent-glow);transform:scale(1.03)}
    .add-btn:disabled{background:var(--surface-2);color:var(--text-3);cursor:not-allowed;transform:none}
    .state-box{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;gap:1rem;padding:5rem 2rem;color:var(--text-3)}
    .state-icon{font-size:3rem;opacity:.3}

    /* Product Detail Modal - –ü.2 */
    .product-detail-modal{position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);z-index:600;display:none;align-items:center;justify-content:center;padding:1.5rem}
    .product-detail-modal.active{display:flex}
    .product-detail-box{background:var(--bg-2);border:1px solid var(--border-hover);border-radius:var(--radius-lg);width:100%;max-width:900px;max-height:90vh;overflow-y:auto;animation:fadeUp .3s var(--ease);display:flex;flex-direction:column}
    @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .product-detail-header{position:sticky;top:0;background:var(--bg-2);padding:1.25rem 1.5rem;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;z-index:10}
    .modal-title{font-family:var(--font-d);font-size:1.125rem;font-weight:700}
    .modal-close{background:none;border:none;color:var(--text-3);font-size:1.25rem;cursor:pointer;padding:.25rem;transition:color .2s}
    .modal-close:hover{color:var(--text)}
    .product-detail-content{padding:2rem;display:grid;grid-template-columns:1fr 1fr;gap:2rem}
    .product-gallery{display:flex;flex-direction:column;gap:1rem}
    .product-main-img{width:100%;aspect-ratio:1;background:var(--bg-3);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:4rem}
    .product-main-img img{width:100%;height:100%;object-fit:cover}
    .product-thumbnails{display:flex;gap:.75rem;overflow-x:auto}
    .product-thumb{width:80px;height:80px;background:var(--bg-3);border:2px solid var(--border);border-radius:var(--radius);cursor:pointer;overflow:hidden;display:flex;align-items:center;justify-content:center;font-size:1.5rem;transition:border-color .2s}
    .product-thumb:hover,.product-thumb.active{border-color:var(--accent)}
    .product-thumb img{width:100%;height:100%;object-fit:cover}
    .product-info{display:flex;flex-direction:column;gap:1.5rem}
    .product-detail-title{font-family:var(--font-b);font-size:1.75rem;font-weight:700;line-height:1.2;margin-bottom:.5rem}
    .product-detail-cat{font-size:.875rem;color:var(--accent);font-weight:600;text-transform:uppercase;letter-spacing:.06em}
    .product-detail-price{font-family:'JetBrains Mono',monospace;font-size:2rem;font-weight:700;color:var(--accent)}
    .product-detail-desc{font-size:.9375rem;line-height:1.7;color:var(--text-2)}
    .product-characteristics{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:1.25rem}
    .char-title{font-family:var(--font-d);font-size:1rem;font-weight:700;margin-bottom:1rem}
    .char-list{display:flex;flex-direction:column;gap:.75rem}
    .char-item{display:flex;justify-content:space-between;align-items:center;padding:.5rem 0;border-bottom:1px solid var(--border)}
    .char-item:last-child{border-bottom:none}
    .char-name{font-size:.875rem;color:var(--text-3);font-weight:600}
    .char-value{font-size:.875rem;color:var(--text);font-weight:500}
    .product-actions{display:flex;gap:1rem;align-items:center;padding-top:1rem;border-top:1px solid var(--border)}
    .qty-selector{display:flex;align-items:center;gap:.75rem}
    .qty-label{font-size:.875rem;color:var(--text-2)}
    .qty-controls{display:flex;align-items:center;gap:.5rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:.25rem}
    .qty-btn{width:32px;height:32px;background:none;border:none;color:var(--text);cursor:pointer;font-size:1.125rem;border-radius:6px;transition:background .2s;display:flex;align-items:center;justify-content:center}
    .qty-btn:hover{background:rgba(255,255,255,.08)}
    .qty-btn:disabled{opacity:.4;cursor:not-allowed}
    .qty-input{width:48px;text-align:center;background:none;border:none;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:.9375rem;font-weight:600}
    .add-to-cart-btn{flex:1;padding:.875rem 1.5rem;background:var(--accent);color:#080A0F;border:none;border-radius:var(--radius);cursor:pointer;font-family:var(--font-b);font-size:.9375rem;font-weight:700;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem}
    .add-to-cart-btn:hover{box-shadow:0 0 24px var(--accent-glow);transform:translateY(-2px)}
    .add-to-cart-btn:disabled{background:var(--surface-2);color:var(--text-3);cursor:not-allowed;transform:none}
    .specs-selector{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:1.25rem}
    .specs-title{font-size:.875rem;font-weight:700;color:var(--text-2);text-transform:uppercase;letter-spacing:.06em;margin-bottom:.75rem}
    .specs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:.75rem}
    .spec-option{padding:.75rem 1rem;background:var(--bg-3);border:2px solid var(--border);border-radius:var(--radius);cursor:pointer;transition:all .2s;text-align:center}
    .spec-option:hover{border-color:var(--border-hover)}
    .spec-option.active{border-color:var(--accent);background:var(--accent-dim)}
    .spec-name{font-size:.8125rem;font-weight:600;margin-bottom:.25rem}
    .spec-price{font-size:.75rem;color:var(--text-3)}
    @media (max-width:768px){
      .product-detail-modal{padding:.75rem}
      .product-detail-content{grid-template-columns:1fr;gap:1.5rem;padding:1.5rem}
      .product-detail-box{max-height:95vh}
      .product-detail-header{padding:1rem 1.25rem}
      .product-detail-title{font-size:1.375rem}
      .product-detail-price{font-size:1.5rem}
      .product-main-img{aspect-ratio:1;font-size:3rem}
      .product-actions{flex-direction:column;gap:.75rem}
      .qty-selector{width:100%;justify-content:space-between}
      .add-to-cart-btn{width:100%}
      .specs-grid{grid-template-columns:repeat(auto-fill,minmax(120px,1fr))}
      .product-thumbnails{overflow-x:auto;-webkit-overflow-scrolling:touch}
    }

    /* ‚ïê‚ïê‚ïê Active Orders Banner ‚ïê‚ïê‚ïê */
    .active-orders-banner{background:linear-gradient(135deg,var(--bg-3) 0%,rgba(0,229,160,.04) 100%);border-top:1px solid var(--border);padding:1rem 0}
    .orders-banner-inner{display:flex;align-items:center;justify-content:space-between;gap:1.5rem;flex-wrap:wrap}
    .orders-banner-left{display:flex;align-items:center;gap:1rem}
    .orders-pulse{width:10px;height:10px;background:var(--green);border-radius:50%;box-shadow:0 0 0 0 rgba(0,229,160,.4);animation:pulse 2s infinite}
    @keyframes pulse{0%{box-shadow:0 0 0 0 rgba(0,229,160,.5)}70%{box-shadow:0 0 0 8px rgba(0,229,160,0)}100%{box-shadow:0 0 0 0 rgba(0,229,160,0)}}
    .orders-banner-text{font-size:.875rem;color:var(--text-2)}
    .orders-banner-text strong{color:var(--green)}
    .orders-banner-count{font-family:var(--font-d);font-size:1.5rem;font-weight:800;color:var(--green)}
    .orders-banner-label{font-size:.75rem;color:var(--text-3);letter-spacing:.04em;text-transform:uppercase;margin-top:.125rem}

    /* Footer */
    .footer{background:var(--bg-2);border-top:1px solid var(--border);padding:2rem 0 1rem}
    .footer-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:2rem;padding-bottom:2rem}
    .footer-col-title{font-size:.75rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;color:var(--text-3);margin-bottom:.75rem}
    .footer-links{list-style:none;display:flex;flex-direction:column;gap:.375rem}
    .footer-links a{font-size:.8125rem;color:var(--text-2);text-decoration:none;transition:color .2s}
    .footer-links a:hover{color:var(--accent)}
    .footer-bottom{border-top:1px solid var(--border);padding-top:1rem;display:flex;justify-content:space-between;flex-wrap:wrap;gap:.75rem}
    .footer-bottom span,.footer-bottom a{font-size:.75rem;color:var(--text-3);text-decoration:none}
    .footer-bottom a:hover{color:var(--accent)}
    .footer-legal{display:flex;gap:1rem;flex-wrap:wrap}

    /* Cart drawer */
    .cart-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:300;opacity:0;pointer-events:none;transition:opacity .3s}
    .cart-overlay.active{opacity:1;pointer-events:all}
    .cart-drawer{position:fixed;right:0;top:0;bottom:0;width:400px;max-width:100vw;background:var(--bg-3);border-left:1px solid var(--border);z-index:400;display:flex;flex-direction:column;transform:translateX(100%);transition:transform .3s var(--ease)}
    .cart-drawer.active{transform:translateX(0)}
    .cart-dh{display:flex;align-items:center;justify-content:space-between;padding:1.25rem 1.5rem;border-bottom:1px solid var(--border)}
    .cart-dh-title{font-family:var(--font-d);font-size:1.125rem;font-weight:700}
    .cart-db{flex:1;overflow-y:auto;padding:1rem 1.5rem}
    .cart-df{padding:1.25rem 1.5rem;border-top:1px solid var(--border)}
    .cart-empty{display:flex;flex-direction:column;align-items:center;gap:.75rem;padding:3rem 0;color:var(--text-3)}
    .cart-empty-icon{font-size:3rem;opacity:.4}
    .cart-item{display:flex;gap:1rem;padding:.875rem 0;border-bottom:1px solid var(--border);align-items:center}
    .cart-item-img{width:56px;height:56px;background:var(--surface);border-radius:var(--radius);display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0;overflow:hidden}
    .cart-item-img img{width:100%;height:100%;object-fit:cover}
    .cart-item-info{flex:1;min-width:0}
    .cart-item-name{font-size:.875rem;font-weight:600;margin-bottom:.25rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .cart-item-price{font-size:.8125rem;color:var(--text-2)}
    .cart-item-remove{background:none;border:none;color:var(--text-3);cursor:pointer;font-size:1rem;padding:.25rem;transition:color .2s}
    .cart-item-remove:hover{color:var(--red)}
    .cart-total-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
    .cart-total-label{font-size:.875rem;color:var(--text-2)}
    .cart-total-amount{font-family:var(--font-d);font-size:1.25rem;font-weight:800}
    .modal-close{background:none;border:none;color:var(--text-3);font-size:1.25rem;cursor:pointer;padding:.25rem;transition:color .2s}
    .modal-close:hover{color:var(--text)}

    /* User menu */
    .user-btn{display:flex;align-items:center;gap:.5rem;background:var(--surface);border:1px solid var(--border);color:var(--text);padding:.375rem .875rem .375rem .5rem;border-radius:var(--radius);cursor:pointer;font-family:var(--font-b);font-size:.875rem;transition:all .2s}
    .user-avatar{width:28px;height:28px;background:linear-gradient(135deg,var(--accent),#0099CC);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:.8125rem;font-weight:700;color:#080A0F}
    .user-dropdown-wrap{position:relative}
    .user-dropdown{position:absolute;right:0;top:calc(100% + .5rem);background:var(--bg-3);border:1px solid var(--border-hover);border-radius:var(--radius-lg);padding:.5rem;min-width:200px;box-shadow:0 12px 40px rgba(0,0,0,.6);opacity:0;pointer-events:none;transform:translateY(-6px);transition:all .2s var(--ease);z-index:50}
    .user-dropdown.active{opacity:1;pointer-events:all;transform:translateY(0)}
    .user-info-box{padding:.5rem .75rem .75rem;border-bottom:1px solid var(--border);margin-bottom:.375rem}
    .user-info-name{font-weight:700;font-size:.9375rem}
    .user-info-email{font-size:.8125rem;color:var(--text-2)}
    .drop-item{display:flex;align-items:center;gap:.5rem;width:100%;padding:.5rem .75rem;background:none;border:none;border-radius:7px;color:var(--text-2);cursor:pointer;font-family:var(--font-b);font-size:.875rem;text-decoration:none;transition:all .2s}
    .drop-item:hover{background:rgba(255,255,255,.06);color:var(--text)}
    .drop-item.danger{color:var(--red)}
    .drop-item.danger:hover{background:var(--red-dim)}

    /* Toast */
    .toast{position:fixed;bottom:6rem;left:50%;transform:translateX(-50%) translateY(1rem);background:var(--surface-2);color:var(--text);padding:.75rem 1.5rem;border-radius:100px;font-size:.875rem;opacity:0;pointer-events:none;transition:all .3s;z-index:9000;white-space:nowrap;border:1px solid var(--border-hover)}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(0)}
    .toast-success{background:var(--green-dim);color:var(--green);border-color:rgba(0,229,160,.25)}
    .toast-error{background:var(--red-dim);color:var(--red);border-color:rgba(255,71,87,.25)}    .qty-btn{width:28px;height:28px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;color:var(--text);cursor:pointer;font-size:1rem;font-weight:700;display:flex;align-items:center;justify-content:center;transition:all .2s}
    .qty-btn:hover{background:var(--accent-dim);border-color:var(--accent);color:var(--accent)}
    .qty-input{width:50px;height:28px;background:var(--surface-2);border:1px solid var(--border);border-radius:6px;color:var(--text);text-align:center;font-size:.875rem;font-weight:600;outline:none}
    .qty-input:focus{border-color:var(--accent);box-shadow:0 0 0 2px var(--accent-dim)}


    @media(max-width:768px){.nav{display:none}.footer-grid{grid-template-columns:1fr 1fr}}
    @media(max-width:480px){.footer-grid{grid-template-columns:1fr}}    /* IMPORT Logo - Lightning bolt effect */
    .logo-mark,.admin-logo-mark,.login-mark{
      position:relative;
      overflow:hidden;
    }
    .logo-mark::after,.admin-logo-mark::after,.login-mark::after{
      content:'‚ö°';
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(135deg,#00D4FF 0%,#0099CC 100%);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      font-size:inherit;
    }

  </style>
</head>
<body>

<header class="header">
  <div class="container">
    <div class="header-inner">
      <a href="/" class="logo">
        <div class="logo-mark">‚ö°</div>
        <span class="logo-text">IM<span>PORT</span></span>
      </a>
      <nav class="nav">
        <a href="/" class="nav-link">–ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/products" class="nav-link active">–ö–∞—Ç–∞–ª–æ–≥</a>
      </nav>
      <div class="header-actions">
        <button class="btn btn-ghost btn-sm cart-btn" id="cartBtn">
          üõí –ö–æ—Ä–∑–∏–Ω–∞ <span class="cart-count" id="cartCount">0</span>
        </button>
        <div class="user-dropdown-wrap" id="userMenu"></div>
      </div>
    </div>
  </div>
</header>

<div class="page-header">
  <div class="page-header-bg"></div>
  <div class="container">
    <div class="page-header-inner">
      <div>
        <h1 class="page-title">–ö–∞—Ç–∞–ª–æ–≥ –∑–∞–ø—á–∞—Å—Ç–µ–π</h1>
        <p class="page-desc">–í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ –Ω–∞–ª–∏—á–∏–∏ ¬∑ –ì–∞—Ä–∞–Ω—Ç–∏—è –∫–∞—á–µ—Å—Ç–≤–∞</p>
      </div>
    </div>
  </div>
</div>

<div class="filter-bar">
  <div class="container">
    <div class="filter-inner">
      <div class="search-wrap">
        <span class="search-icon">üîç</span>
        <input type="search" class="search-input" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É‚Ä¶">
      </div>
      <select class="filter-select" id="sortSelect">
        <option value="">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</option>
        <option value="price-asc">–°–Ω–∞—á–∞–ª–∞ –¥–µ—à–µ–≤–ª–µ</option>
        <option value="price-desc">–°–Ω–∞—á–∞–ª–∞ –¥–æ—Ä–æ–∂–µ</option>
        <option value="name">–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é</option>
      </select>
      <span class="filter-count" id="filterCount"></span>
    </div>
  </div>
</div>

<main class="main">
  <div class="container">
    <div class="cat-pills" id="catPills">
      <div class="cat-pill active" data-cat="all">üõí –í—Å–µ —Ç–æ–≤–∞—Ä—ã</div>
    </div>
    <div class="products-grid" id="productsGrid">
      <div class="state-box"><div class="state-icon">‚è≥</div><p>–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</p></div>
    </div>
  </div>
</main>

<!-- ‚ïê‚ïê‚ïê ACTIVE ORDERS BANNER ‚ïê‚ïê‚ïê -->
<div class="active-orders-banner">
  <div class="container">
    <div class="orders-banner-inner">
      <div class="orders-banner-left">
        <div class="orders-pulse"></div>
        <div class="orders-banner-text">
          –°–µ–π—á–∞—Å –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ: <strong id="activeOrdersCount">‚Ä¶</strong> –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
        </div>
      </div>
      <div style="text-align:right">
        <div class="orders-banner-count" id="activeOrdersCountBig">‚Äî</div>
        <div class="orders-banner-label">–∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</div>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <div class="footer-grid">
      <div>
        <div class="footer-col-title">–ö–∞—Ç–∞–ª–æ–≥</div>
        <ul class="footer-links" id="footerCatLinks">
          <li><a href="/products">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</a></li>
        </ul>
      </div>
      <div>
        <div class="footer-col-title">–î–æ–∫—É–º–µ–Ω—Ç—ã</div>
        <ul class="footer-links">
          <li><a href="/terms">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</a></li>
          <li><a href="/privacy-policy">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a></li>
          <li><a href="/offer">–î–æ–≥–æ–≤–æ—Ä –æ—Ñ–µ—Ä—Ç—ã</a></li>
          <li><a href="/returns">–í–æ–∑–≤—Ä–∞—Ç –∏ –æ–±–º–µ–Ω</a></li>
        </ul>
      </div>
      <div>
        <div class="footer-col-title">–ö–æ–Ω—Ç–∞–∫—Ç—ã</div>
        <div style="font-size:.8125rem;color:var(--text-2);line-height:2">
          <div>üìû 8 (800) 123-45-67</div>
          <div>‚úâÔ∏è info@import.ru</div>
          <div>üïê –ï–∂–µ–¥–Ω–µ–≤–Ω–æ 9:00‚Äì21:00</div>
        </div>
      </div>
      <div>
        <div class="footer-col-title">–ü–æ–∫—É–ø–∞—Ç–µ–ª—è–º</div>
        <ul class="footer-links">
          <li><a href="/returns">–í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–∞</a></li>
          <li><a href="/offer">–£—Å–ª–æ–≤–∏—è –ø—Ä–æ–¥–∞–∂–∏</a></li>
          <li><a href="/privacy-policy">–ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <span>¬© 2025 IMPORT. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</span>
      <div class="footer-legal">
        <a href="/terms">–°–æ–≥–ª–∞—à–µ–Ω–∏–µ</a>
        <a href="/privacy-policy">–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</a>
        <a href="/offer">–û—Ñ–µ—Ä—Ç–∞</a>
        <a href="/returns">–í–æ–∑–≤—Ä–∞—Ç</a>
      </div>
    </div>
  </div>
</footer>

<!-- Cart Drawer -->
<div class="cart-overlay" id="cartOverlay"></div>
<div class="cart-drawer" id="cartDrawer">
  <div class="cart-dh">
    <div class="cart-dh-title">üõí –ö–æ—Ä–∑–∏–Ω–∞</div>
    <button class="modal-close" id="closeCartDrawer">‚úï</button>
  </div>
  <div class="cart-db" id="cartBody">
    <div class="cart-empty"><div class="cart-empty-icon">üõí</div><p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p></div>
  </div>
  <div class="cart-df">
    <div class="cart-total-row">
      <span class="cart-total-label">–ò—Ç–æ–≥–æ</span>
      <span class="cart-total-amount" id="cartTotal">0 ‚ÇΩ</span>
    </div>
    <button class="btn btn-primary" style="width:100%" id="checkoutBtn" disabled>–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê PRODUCT DETAIL MODAL (–ü.2) ‚ïê‚ïê -->
<div class="product-detail-modal" id="productDetailModal">
  <div class="product-detail-box">
    <div class="product-detail-header">
      <h2 class="modal-title">–î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞</h2>
      <button class="modal-close" id="closeProductDetail">‚úï</button>
    </div>
    <div class="product-detail-content" id="productDetailContent">
      <!-- Content loaded dynamically -->
    </div>
  </div>
</div>

<script>
  let currentUser = null, cart = [], allProducts = [], currentCat = 'all', searchTerm = '';

  const catPills    = document.getElementById('catPills');
  const productsGrid= document.getElementById('productsGrid');
  const searchInput = document.getElementById('searchInput');
  const sortSelect  = document.getElementById('sortSelect');
  const filterCount = document.getElementById('filterCount');
  const cartDrawer  = document.getElementById('cartDrawer');
  const cartOverlay = document.getElementById('cartOverlay');
  const cartBody    = document.getElementById('cartBody');
  const cartTotal   = document.getElementById('cartTotal');
  const checkoutBtn = document.getElementById('checkoutBtn');
  const cartCount   = document.getElementById('cartCount');
  const userMenu    = document.getElementById('userMenu');
  const toast       = document.getElementById('toast');

  function showToast(type, text) {
    toast.textContent = text;
    toast.className = `toast toast-${type} show`;
    setTimeout(() => toast.classList.remove('show'), 3200);
  }
  function fmt(n) { return new Intl.NumberFormat('ru-RU').format(n); }

  // Category emoji map ‚Äî dynamically updated
  let catIcons = { batteries:'üîã', motors:'‚öôÔ∏è', electronics:'üì±', brakes:'üõë', tires:'üõû', accessories:'üîß' };
  let catNames = { batteries:'–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã', motors:'–ú–æ—Ç–æ—Ä—ã', electronics:'–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', brakes:'–¢–æ—Ä–º–æ–∑–∞', tires:'–ö–æ–ª—ë—Å–∞', accessories:'–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã' };

  function getIcon(cat) { return catIcons[cat] || 'üì¶'; }
  function getName(cat) { return catNames[cat] || cat; }

  // ‚îÄ‚îÄ Categories ‚îÄ‚îÄ
  async function loadCategories() {
    try {
      const r = await fetch('/api/categories');
      if (!r.ok) return;
      const { categories } = await r.json();
      // Update maps
      categories.forEach(c => { catIcons[c.slug] = c.emoji; catNames[c.slug] = c.name; });

      // Update pills
      const existing = catPills.querySelectorAll('.cat-pill:not([data-cat="all"])');
      existing.forEach(e => e.remove());
      categories.forEach(c => {
        const pill = document.createElement('div');
        pill.className = 'cat-pill';
        pill.dataset.cat = c.slug;
        pill.textContent = `${c.emoji} ${c.name}`;
        if (c.count) pill.textContent += ` (${c.count})`;
        catPills.appendChild(pill);
      });

      // Update footer links
      const footerLinks = document.getElementById('footerCatLinks');
      if (footerLinks) {
        footerLinks.innerHTML = '<li><a href="/products">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</a></li>' +
          categories.map(c => `<li><a href="/products?category=${c.slug}">${c.emoji} ${c.name}</a></li>`).join('');
      }

      attachPillListeners();
    } catch {}
  }

  function attachPillListeners() {
    catPills.querySelectorAll('.cat-pill').forEach(pill => {
      pill.addEventListener('click', () => {
        catPills.querySelectorAll('.cat-pill').forEach(p => p.classList.remove('active'));
        pill.classList.add('active');
        currentCat = pill.dataset.cat;
        renderProducts();
      });
    });
  }

  // ‚îÄ‚îÄ Products ‚îÄ‚îÄ
  async function loadProducts() {
    try {
      const r = await fetch('/api/products');
      if (!r.ok) return;
      allProducts = await r.json();
      renderProducts();
    } catch {}
  }

  function renderProducts() {
    let filtered = allProducts;
    if (currentCat !== 'all') filtered = filtered.filter(p => p.category === currentCat);
    if (searchTerm) {
      const q = searchTerm.toLowerCase();
      filtered = filtered.filter(p => p.name.toLowerCase().includes(q) || p.description.toLowerCase().includes(q));
    }
    const sort = sortSelect.value;
    if (sort === 'price-asc') filtered.sort((a,b) => a.price - b.price);
    else if (sort === 'price-desc') filtered.sort((a,b) => b.price - a.price);
    else if (sort === 'name') filtered.sort((a,b) => a.name.localeCompare(b.name));

    filterCount.textContent = `${filtered.length} —Ç–æ–≤–∞—Ä${filtered.length===1?'':'–æ–≤'}`;

    if (!filtered.length) {
      productsGrid.innerHTML = `<div class="state-box"><div class="state-icon">üîç</div><p>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</p></div>`;
      return;
    }

    productsGrid.innerHTML = filtered.map(p => {
      const icon = getIcon(p.category);
      const hasValidImage = p.image_url && p.image_url.trim() && 
                           (p.image_url.startsWith('/static/uploads/') || 
                            p.image_url.startsWith('http://') || 
                            p.image_url.startsWith('https://'));
      const imgHtml = hasValidImage
        ? `<img src="${p.image_url}" alt="${p.name}" loading="lazy" onload="this.classList.add('loaded')" onerror="this.parentElement.innerHTML='${icon}'">`
        : icon;
          
      // –§–æ—Ä–º–∏—Ä—É–µ–º –±–µ–π–¥–∂–∏ –∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      let badges = [];
      if (p.featured) badges.push('<span class="product-badge-inline badge-featured">‚≠ê –ü–æ–ø—É–ª—è—Ä–Ω—ã–π</span>');
      if (p.in_stock) badges.push('<span class="product-badge-inline badge-stock">‚úì –í –Ω–∞–ª–∏—á–∏–∏</span>');
      if (p.preorder) badges.push('<span class="product-badge-inline badge-preorder">üì¶ –ü—Ä–µ–¥–∑–∞–∫–∞–∑</span>');
      if (p.stock === 0) badges.push('<span class="product-badge-inline badge-out">‚úï –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span>');
      const badgesHtml = badges.length ? `<div class="product-badges">${badges.join('')}</div>` : '';
      
      return `
      <div class="product-card" onclick="openProductDetail(${p.id})" style="cursor:pointer">
        <div class="product-img">${imgHtml}</div>
        <div class="product-body">
          ${badgesHtml}
          <div class="product-cat">${getName(p.category)}</div>
          <div class="product-name">${p.name}</div>
          <div class="product-desc">${p.description}</div>
          <div class="product-footer">
            <span class="product-price">${fmt(p.price)} ‚ÇΩ</span>
            <button class="add-btn" onclick="event.stopPropagation(); addToCart(${p.id},${p.stock})" ${!p.in_stock && !p.preorder?'disabled':''}>
              ${p.in_stock || p.preorder ? '–í –∫–æ—Ä–∑–∏–Ω—É' : '–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
            </button>
          </div>
        </div>
      </div>`;
    }).join('');
  }

  searchInput.addEventListener('input', () => { searchTerm = searchInput.value; renderProducts(); });
  sortSelect.addEventListener('change', renderProducts);

  // ‚îÄ‚îÄ Active Orders Banner ‚îÄ‚îÄ
  async function loadActiveOrders() {
    try {
      const r = await fetch('/api/orders/active-count');
      if (!r.ok) return;
      const { count } = await r.json();
      document.getElementById('activeOrdersCount').textContent = count;
      document.getElementById('activeOrdersCountBig').textContent = count;
    } catch {}
    setTimeout(loadActiveOrders, 30000); // –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
  }

  // ‚îÄ‚îÄ Auth ‚îÄ‚îÄ
  async function checkAuth(token) {
    try {
      const r = await fetch('/api/me', { headers: { Authorization: `Bearer ${token}` } });
      if (r.ok) { currentUser = await r.json(); updateAuthUI(); loadCart(); }
      else localStorage.removeItem('token');
    } catch {}
  }

  function updateAuthUI() {
    userMenu.innerHTML = '';
    if (currentUser) {
      const initial = (currentUser.username || '?')[0].toUpperCase();
      userMenu.innerHTML = `
        <div class="user-dropdown-wrap">
          <button class="user-btn" id="userMenuBtn">
            <div class="user-avatar">${initial}</div>
            <span>${currentUser.username}</span><span>‚ñæ</span>
          </button>
          <div class="user-dropdown" id="userDropdown">
            <div class="user-info-box">
              <div class="user-info-name">${currentUser.username}</div>
              <div class="user-info-email">${currentUser.email}</div>
            </div>
            ${currentUser.is_admin ? '<a href="/admin" class="drop-item">‚öôÔ∏è –ü–∞–Ω–µ–ª—å admin</a>' : ''}
            <button class="drop-item danger" onclick="logout()">‚Üê –í—ã–π—Ç–∏</button>
          </div>
        </div>`;
      document.getElementById('userMenuBtn').addEventListener('click', e => {
        e.stopPropagation();
        document.getElementById('userDropdown').classList.toggle('active');
      });
    } else {
      userMenu.innerHTML = `<button class="btn btn-primary btn-sm" onclick="location.href='/'">–í–æ–π—Ç–∏</button>`;
    }
  }
  document.addEventListener('click', () => document.getElementById('userDropdown')?.classList.remove('active'));

  function logout() { localStorage.removeItem('token'); currentUser = null; cart = []; updateAuthUI(); updateCartUI(); showToast('success','–í—ã –≤—ã—à–ª–∏'); }

  // ‚îÄ‚îÄ Cart ‚îÄ‚îÄ
  document.getElementById('cartBtn').addEventListener('click', () => {
    cartDrawer.classList.add('active'); cartOverlay.classList.add('active');
    if (currentUser) loadCart();
  });
  cartOverlay.addEventListener('click', closeCart);
  document.getElementById('closeCartDrawer').addEventListener('click', closeCart);
  function closeCart() { cartDrawer.classList.remove('active'); cartOverlay.classList.remove('active'); }

  async function loadCart() {
    const token = localStorage.getItem('token');
    if (!token) return;
    try {
      const r = await fetch('/api/cart', { headers: { Authorization: `Bearer ${token}` } });
      if (r.ok) { const data = await r.json(); cart = data.items || []; updateCartUI(); }
    } catch {}
  }

  function updateCartUI() {
    const count = cart.reduce((s,i)=>s+i.quantity,0);
    cartCount.textContent = count; cartCount.style.display = count>0?'flex':'none';
    if (!cart.length) {
      cartBody.innerHTML = '<div class="cart-empty"><div class="cart-empty-icon">üõí</div><p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p></div>';
      cartTotal.textContent = '0 ‚ÇΩ'; checkoutBtn.disabled = true; return;
    }
    const total = cart.reduce((s,i)=>s+i.item_total,0);
    cartTotal.textContent = fmt(total) + ' ‚ÇΩ'; checkoutBtn.disabled = false;
    cartBody.innerHTML = cart.map(item => {
      const p = item.product;
      const imgSrc = p.image_url && p.image_url.startsWith('/static/uploads') ? `<img src="${p.image_url}" alt="${p.name}">` : getIcon(p.category);
      return `<div class="cart-item">
        <div class="cart-item-img">${imgSrc}</div>
        <div class="cart-item-info">
          <div class="cart-item-name">${p.name}</div>
          <div style="display:flex;align-items:center;gap:.5rem;margin-top:.25rem">
            <button class="qty-btn" onclick="updateQuantity(${p.id}, ${item.quantity - 1}, ${p.stock})">‚àí</button>
            <input type="number" class="qty-input" value="${item.quantity}" min="1" max="${p.stock}" onchange="updateQuantity(${p.id}, this.value, ${p.stock})">
            <button class="qty-btn" onclick="updateQuantity(${p.id}, ${item.quantity + 1}, ${p.stock})">+</button>
          </div>
          <div style="font-size:.8125rem;color:var(--text-2);margin-top:.25rem">${fmt(p.price)} ‚ÇΩ √ó ${item.quantity} = ${fmt(item.item_total)} ‚ÇΩ</div>
        </div>
        <button class="cart-item-remove" onclick="removeFromCart(${p.id})">‚úï</button>
      </div>`;
    }).join('');
  }

  async function addToCart(productId, stock) {
    const token = localStorage.getItem('token');
    if (!token) { location.href = '/'; return; }
    if (stock<=0) { showToast('error','–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'); return; }
    try {
      const r = await fetch('/api/cart',{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${token}`},body:JSON.stringify({product_id:productId,quantity:1})});
      if (r.ok) { await loadCart(); showToast('success','‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É'); }
      else { const d = await r.json(); showToast('error',d.detail||'–û—à–∏–±–∫–∞'); }
    } catch { showToast('error','–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'); }
  }

  async function removeFromCart(productId) {
    const token = localStorage.getItem('token'); if (!token) return;
    try {
      const r = await fetch(`/api/cart/${productId}`,{method:'DELETE',headers:{Authorization:`Bearer ${token}`}});
      if (r.ok) { await loadCart(); showToast('success','–£–¥–∞–ª–µ–Ω–æ –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã'); }
    } catch {}
  }

  checkoutBtn.addEventListener('click', async () => {
    const token = localStorage.getItem('token'); if (!token) { location.href='/'; return; }
    try {
      const r = await fetch('/api/orders',{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${token}`},body:JSON.stringify({delivery_address:'',comment:''})});
      const data = await r.json();
      if (r.ok) { cart=[]; updateCartUI(); closeCart(); showToast('success',`‚úì –ó–∞–∫–∞–∑ #${data.order_id} –æ—Ñ–æ—Ä–º–ª–µ–Ω!`); loadActiveOrders(); }
      else showToast('error',data.detail||'–û—à–∏–±–∫–∞');
    } catch { showToast('error','–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'); }
  });


  async function updateQuantity(productId, newQty, maxStock) {
    const qty = Math.max(1, Math.min(parseInt(newQty), maxStock));
    const token = localStorage.getItem('token');
    if (!token) return;
    try {
      const r = await fetch(`/api/cart/${productId}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
        body: JSON.stringify({ quantity: qty })
      });
      if (r.ok) { await loadCart(); }
      else { const d = await r.json(); showToast('error', d.detail || '–û—à–∏–±–∫–∞'); }
    } catch { showToast('error', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è'); }
  }

  // ‚îÄ‚îÄ Read URL params ‚îÄ‚îÄ
  const urlParams = new URLSearchParams(location.search);
  const urlCat = urlParams.get('category');
  if (urlCat) currentCat = urlCat;

  // ‚îÄ‚îÄ PRODUCT DETAIL MODAL (–ü.2) ‚îÄ‚îÄ
  const productDetailModal = document.getElementById('productDetailModal');
  const closeProductDetail = document.getElementById('closeProductDetail');
  const productDetailContent = document.getElementById('productDetailContent');
  let currentDetailProduct = null;
  let selectedSpec = null;
  let detailQty = 1;
  
  async function openProductDetail(productId) {
    try {
      const r = await fetch(`/api/products/${productId}`);
      if (!r.ok) return showToast('error', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–≤–∞—Ä');
      const product = await r.json();
      currentDetailProduct = product;
      selectedSpec = null;
      detailQty = 1;
      renderProductDetail(product);
      productDetailModal.classList.add('active');
      document.body.style.overflow = 'hidden';
    } catch (e) {
      showToast('error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–∞');
    }
  }
  
  function renderProductDetail(p) {
    const icon = getIcon(p.category);
    const hasValidImage = p.image_url && p.image_url.trim() && 
                         (p.image_url.startsWith('/static/uploads/') || 
                          p.image_url.startsWith('http://') || 
                          p.image_url.startsWith('https://'));
    
    const mainImgHtml = hasValidImage
      ? `<img src="${p.image_url}" alt="${p.name}" onerror="this.parentElement.innerHTML='${icon}'">`
      : icon;
    
    let thumbnailsHtml = '';
    if (p.images && p.images.length > 0) {
      const allImages = [p.image_url, ...p.images];
      thumbnailsHtml = `
        <div class="product-thumbnails">
          ${allImages.map((img, idx) => {
            const imgSrc = img && img.trim() ? img : '';
            return imgSrc ? `<div class="product-thumb ${idx === 0 ? 'active' : ''}" onclick="switchProductImage('${imgSrc}', this)">
              <img src="${imgSrc}" alt="–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${idx + 1}">
            </div>` : '';
          }).join('')}
        </div>
      `;
    }
    
    let charsHtml = '';
    if (p.characteristics && p.characteristics.length > 0) {
      charsHtml = `
        <div class="product-characteristics">
          <div class="char-title">üìã –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</div>
          <div class="char-list">
            ${p.characteristics.map(c => `
              <div class="char-item">
                <span class="char-name">${c.char_name}</span>
                <span class="char-value">${c.char_value}</span>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }
    
    let specsHtml = '';
    if (p.has_specifications && p.specifications && p.specifications.length > 0) {
      specsHtml = `
        <div class="specs-selector">
          <div class="specs-title">üîß –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é / –ø–æ–∫–æ–ª–µ–Ω–∏–µ</div>
          <div class="specs-grid">
            ${p.specifications.map((spec, idx) => `
              <div class="spec-option ${selectedSpec?.id === spec.id ? 'active' : ''}" 
                   onclick="selectSpecification(${spec.id})">
                <div class="spec-name">${spec.name}</div>
                <div class="spec-price">${fmt(spec.price)} ‚ÇΩ</div>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }
    
    const currentItem = selectedSpec || p;
    const currentPrice = selectedSpec ? selectedSpec.price : p.price;
    const currentStock = selectedSpec ? selectedSpec.stock : p.stock;
    const inStock = currentStock > 0;
    
    productDetailContent.innerHTML = `
      <div class="product-gallery">
        <div class="product-main-img" id="productMainImg">${mainImgHtml}</div>
        ${thumbnailsHtml}
      </div>
      <div class="product-info">
        <div>
          <div class="product-detail-cat">${getName(p.category)}</div>
          <h2 class="product-detail-title">${p.name}${selectedSpec ? ` - ${selectedSpec.name}` : ''}</h2>
          <div class="product-detail-price">${fmt(currentPrice)} ‚ÇΩ</div>
        </div>
        
        ${specsHtml}
        
        <div class="product-detail-desc">
          <strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong><br>
          ${selectedSpec ? selectedSpec.description || p.description : p.description}
        </div>
        
        ${charsHtml}
        
        <div class="product-actions">
          <div class="qty-selector">
            <span class="qty-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span>
            <div class="qty-controls">
              <button class="qty-btn" onclick="changeDetailQty(-1)" ${!inStock ? 'disabled' : ''}>‚àí</button>
              <input type="number" class="qty-input" value="${detailQty}" min="1" max="${currentStock}" readonly>
              <button class="qty-btn" onclick="changeDetailQty(1)" ${!inStock ? 'disabled' : ''}>+</button>
            </div>
          </div>
          <button class="add-to-cart-btn" onclick="addToCartFromDetail()" ${!inStock ? 'disabled' : ''}>
            ${inStock ? 'üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É' : '‚úï –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
          </button>
        </div>
      </div>
    `;
  }
  
  function switchProductImage(imgSrc, thumbEl) {
    document.getElementById('productMainImg').innerHTML = `<img src="${imgSrc}" alt="Product image">`;
    document.querySelectorAll('.product-thumb').forEach(t => t.classList.remove('active'));
    thumbEl.classList.add('active');
  }
  
  function selectSpecification(specId) {
    if (!currentDetailProduct.specifications) return;
    selectedSpec = currentDetailProduct.specifications.find(s => s.id === specId);
    detailQty = 1;
    renderProductDetail(currentDetailProduct);
  }
  
  function changeDetailQty(delta) {
    const currentItem = selectedSpec || currentDetailProduct;
    const maxStock = currentItem.stock || 0;
    detailQty = Math.max(1, Math.min(detailQty + delta, maxStock));
    renderProductDetail(currentDetailProduct);
  }
  
  async function addToCartFromDetail() {
    const token = localStorage.getItem('token');
    if (!token) {
      productDetailModal.classList.remove('active');
      document.body.style.overflow = '';
      location.href = '/';
      return;
    }
    
    if (currentDetailProduct.has_specifications && currentDetailProduct.specifications.length > 0 && !selectedSpec) {
      showToast('error', '–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é / –ø–æ–∫–æ–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞');
      return;
    }
    
    const productId = currentDetailProduct.id;
    const stock = selectedSpec ? selectedSpec.stock : currentDetailProduct.stock;
    
    if (stock <= 0) {
      showToast('error', '–¢–æ–≤–∞—Ä –Ω–µ –≤ –Ω–∞–ª–∏—á–∏–∏');
      return;
    }
    
    try {
      const r = await fetch('/api/cart', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
        body: JSON.stringify({ product_id: productId, quantity: detailQty })
      });
      
      if (r.ok) {
        await loadCart();
        productDetailModal.classList.remove('active');
        document.body.style.overflow = '';
        showToast('success', `‚úì –î–æ–±–∞–≤–ª–µ–Ω–æ ${detailQty} —à—Ç. –≤ –∫–æ—Ä–∑–∏–Ω—É`);
      } else {
        const d = await r.json();
        showToast('error', d.detail || '–û—à–∏–±–∫–∞');
      }
    } catch {
      showToast('error', '–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è');
    }
  }
  
  closeProductDetail.addEventListener('click', () => {
    productDetailModal.classList.remove('active');
    document.body.style.overflow = '';
  });
  
  productDetailModal.addEventListener('click', (e) => {
    if (e.target === productDetailModal) {
      productDetailModal.classList.remove('active');
      document.body.style.overflow = '';
    }
  });

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
  (async () => {
    updateAuthUI();
    await loadCategories();
    await loadProducts();
    await loadActiveOrders();
    if (urlCat) {
      catPills.querySelectorAll('.cat-pill').forEach(p => {
        p.classList.toggle('active', p.dataset.cat === urlCat);
      });
    }
    const token = localStorage.getItem('token');
    if (token) await checkAuth(token);
  })();
</script>
</body>
</html>
